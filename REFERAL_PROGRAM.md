# Marie Lou Referral Program â€” Design Document

## Program Name Options

| Name                  | German            | Vibe                                             |
| --------------------- | ----------------- | ------------------------------------------------ |
| **Marie Lou's Table** | Marie Lous Tisch  | Ties to grandma's kitchen table, inviting others |
| **Share the Love**    | Teile die Liebe   | Warm, matches brand                              |
| **Spread the Warmth** | WÃ¤rme weitergeben | Coffee + emotional warmth                        |
| **Coffee Friends**    | Kaffeefreunde     | Simple, friendly                                 |

**Recommendation:** "Marie Lou's Table" â€” it directly connects to the story. Just like grandma always invited someone new to her table, you're inviting friends to join yours.

---

## Program Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                        MARIE LOU'S TABLE                                    â”‚
â”‚                     Referral Program Flow                                   â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   EXISTING CUSTOMER                         NEW FRIEND                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚                                                                             â”‚
â”‚   Has account + at least                    Receives referral               â”‚
â”‚   one completed order                       link from friend                â”‚
â”‚          â”‚                                        â”‚                         â”‚
â”‚          â”‚  Shares unique                         â”‚                         â”‚
â”‚          â”‚  referral link â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚                         â”‚
â”‚          â”‚                                        â”‚                         â”‚
â”‚          â”‚                                        â–¼                         â”‚
â”‚          â”‚                                  Signs up using                  â”‚
â”‚          â”‚                                  referral link                   â”‚
â”‚          â”‚                                        â”‚                         â”‚
â”‚          â”‚                                        â–¼                         â”‚
â”‚          â”‚                                  Places first order              â”‚
â”‚          â”‚                                  (min. â‚¬25 before shipping)      â”‚
â”‚          â”‚                                        â”‚                         â”‚
â”‚          â”‚                                        â–¼                         â”‚
â”‚          â”‚                                  Friend gets:                    â”‚
â”‚          â”‚                                  10% off first order             â”‚
â”‚          â”‚                                        â”‚                         â”‚
â”‚          â”‚         Order confirmed                â”‚                         â”‚
â”‚          â”‚         & paid                         â”‚                         â”‚
â”‚          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â–¼                                                                  â”‚
â”‚   Referrer gets:                                                            â”‚
â”‚   FREE random bag                                                           â”‚
â”‚   of coffee!                                                                â”‚
â”‚   (added to next order                                                      â”‚
â”‚   or ships for â‚¬4.95)                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Program Rules

### For the Referrer (Existing Customer)

| Rule                | Detail                                            |
| ------------------- | ------------------------------------------------- |
| **Eligibility**     | Must have account + at least 1 completed order    |
| **Reward**          | 1 free random bag of coffee (250g)                |
| **When earned**     | After referred friend's first order is paid       |
| **Reward delivery** | Added to next order OR ships separately for â‚¬4.95 |
| **Limit**           | No cap (but monitored for abuse)                  |
| **Expiry**          | Rewards don't expire                              |
| **Stackable**       | Yes â€” refer 5 friends, get 5 free bags            |

### For the Referred Friend (New Customer)

| Rule              | Detail                                     |
| ----------------- | ------------------------------------------ |
| **Eligibility**   | Must be new customer (email not in system) |
| **Reward**        | 10% off first order                        |
| **Minimum order** | â‚¬25 before shipping                        |
| **Link expiry**   | 90 days from creation                      |
| **Combinable**    | Not combinable with other discounts        |

### Anti-Abuse Rules

| Risk          | Prevention                                                                                                           |
| ------------- | -------------------------------------------------------------------------------------------------------------------- |
| Self-referral | Referrer and referred cannot have same email domain (for work emails), same shipping address, or same payment method |
| Fake accounts | Referred friend must complete a real order with valid payment                                                        |
| Churning      | One referral reward per unique email address, ever                                                                   |
| Mass abuse    | Flag accounts with >20 referrals/month for manual review                                                             |
| Refund gaming | If referred friend refunds within 30 days, reward is revoked                                                         |

---

## Technical Implementation

### Database Schema Addition

```typescript
// Add to src/db/schema.ts

// Referral codes
export const referralCodes = sqliteTable('referral_codes', {
  id: text('id').primaryKey(),
  customerId: text('customer_id').references(() => customers.id),
  code: text('code').notNull().unique(),        // MARIE-XXXXX (5 chars)
  
  // Stats
  timesUsed: integer('times_used').default(0),
  totalRewardsEarned: integer('total_rewards_earned').default(0),
  
  createdAt: integer('created_at', { mode: 'timestamp' }),
  active: integer('active', { mode: 'boolean' }).default(true),
});

// Referral tracking
export const referrals = sqliteTable('referrals', {
  id: text('id').primaryKey(),
  referrerCodeId: text('referrer_code_id').references(() => referralCodes.id),
  referrerId: text('referrer_id').references(() => customers.id),
  referredId: text('referred_id').references(() => customers.id),
  referredEmail: text('referred_email').notNull(),
  
  // Status workflow
  status: text('status').notNull(),  // 'pending' | 'qualified' | 'rewarded' | 'revoked'
  
  // The qualifying order
  qualifyingOrderId: text('qualifying_order_id').references(() => orders.id),
  
  // Reward tracking
  rewardId: text('reward_id').references(() => referralRewards.id),
  
  // Timestamps
  createdAt: integer('created_at', { mode: 'timestamp' }),
  qualifiedAt: integer('qualified_at', { mode: 'timestamp' }),
  rewardedAt: integer('rewarded_at', { mode: 'timestamp' }),
  revokedAt: integer('revoked_at', { mode: 'timestamp' }),
  revokeReason: text('revoke_reason'),
});

// Referral rewards (the free bags)
export const referralRewards = sqliteTable('referral_rewards', {
  id: text('id').primaryKey(),
  customerId: text('customer_id').references(() => customers.id),
  referralId: text('referral_id').references(() => referrals.id),
  
  // The reward
  productId: text('product_id').notNull(),       // Which coffee they'll get
  productName: text('product_name').notNull(),   // Snapshot
  
  // Status
  status: text('status').notNull(),  // 'pending' | 'claimed' | 'shipped' | 'expired'
  
  // How it was redeemed
  claimedOrderId: text('claimed_order_id').references(() => orders.id),
  shippedSeparately: integer('shipped_separately', { mode: 'boolean' }).default(false),
  
  // Timestamps
  createdAt: integer('created_at', { mode: 'timestamp' }),
  claimedAt: integer('claimed_at', { mode: 'timestamp' }),
  expiresAt: integer('expires_at', { mode: 'timestamp' }),  // Optional: if you want expiry
});

// Referral stats (for analytics)
export const REFERRAL_STATUS = {
  pending: 'Pending',           // Friend signed up but hasn't ordered
  qualified: 'Qualified',       // Friend placed qualifying order
  rewarded: 'Rewarded',         // Referrer received free bag
  revoked: 'Revoked',           // Cancelled due to refund/abuse
} as const;
```

### Referral Code Generation

```typescript
// src/lib/referral.ts

// Generate unique, memorable referral codes
export function generateReferralCode(customerName: string): string {
  // Format: MARIE-XXXXX
  // Use a mix of letters (no ambiguous ones like 0/O, 1/I/L)
  const chars = 'ABCDEFGHJKMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 5; i++) {
    code += chars[Math.floor(Math.random() * chars.length)];
  }
  return `MARIE-${code}`;
}

// Referral link format
export function getReferralLink(code: string, brand: 'coffee' | 'tea'): string {
  const domain = brand === 'coffee' ? 'marieloucoffee.com' : 'marieloutea.com';
  return `https://${domain}/ref/${code}`;
}
```

### API Endpoints

```typescript
// src/app/api/referral/route.ts

// GET: Get current user's referral code + stats
// POST: Generate referral code for user (if they don't have one)

// src/app/api/referral/validate/route.ts
// GET: Validate a referral code (for signup page)

// src/app/api/referral/apply/route.ts
// POST: Apply referral code during checkout

// src/app/api/referral/rewards/route.ts
// GET: List user's pending rewards
// POST: Claim reward (add to cart or ship separately)
```

### Random Bag Selection Logic

```typescript
// src/lib/referral.ts

export async function selectRandomRewardBag(brand: 'coffee' | 'tea'): Promise<Product> {
  const products = await db.query.products.findMany({
    where: and(
      eq(products.brand, brand),
      eq(products.active, true),
      gt(products.stockQuantity, 10)  // Only if well-stocked
    ),
  });
  
  // Weighted random: slightly favor slower-moving products
  // This helps clear inventory while still feeling random
  const weights = products.map(p => {
    const baseWeight = 1;
    // Boost weight for products with higher stock (helps move inventory)
    const stockBoost = p.stockQuantity > 50 ? 1.5 : 1;
    return baseWeight * stockBoost;
  });
  
  const totalWeight = weights.reduce((a, b) => a + b, 0);
  let random = Math.random() * totalWeight;
  
  for (let i = 0; i < products.length; i++) {
    random -= weights[i];
    if (random <= 0) return products[i];
  }
  
  return products[0]; // Fallback
}
```

---

## User Interface

### 1. Account Page â€” Referral Section

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  ðŸŽ MARIE LOU'S TABLE                                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                        â”‚
â”‚                                                                             â”‚
â”‚  Invite friends to the table. When they order, you get a free bag!          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Your referral link:                                                  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ marieloucoffee.com/ref/MARIE-HK7M2         â”‚  â”‚  ðŸ“‹ Copy Link  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  Or share directly:  [WhatsApp] [Email] [Twitter] [Copy]             â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  ðŸ“Š Your Referral Stats                                                     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Friends    â”‚  â”‚  Pending    â”‚  â”‚  Free Bags  â”‚                          â”‚
â”‚  â”‚  Referred   â”‚  â”‚  Signups    â”‚  â”‚  Earned     â”‚                          â”‚
â”‚  â”‚      7      â”‚  â”‚      2      â”‚  â”‚      5      â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  ðŸŽ‰ Your Rewards                                                            â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ðŸŽ FREE: Colombia Huila (250g)                                       â”‚  â”‚
â”‚  â”‚     Earned from referring Sarah M.                                    â”‚  â”‚
â”‚  â”‚     [Add to Next Order]  [Ship Now (â‚¬4.95)]                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ðŸŽ FREE: Ethiopia Yirgacheffe (250g)                                 â”‚  â”‚
â”‚  â”‚     Earned from referring Thomas K.                                   â”‚  â”‚
â”‚  â”‚     [Add to Next Order]  [Ship Now (â‚¬4.95)]                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Referral Landing Page (/ref/[code])

When someone clicks a referral link:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                           [Marie Lou Logo]                                  â”‚
â”‚                                                                             â”‚
â”‚                    Your friend thinks you'll love this.                     â”‚
â”‚                                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â”‚
â”‚                                                                             â”‚
â”‚                        Welcome to Marie Lou Coffee                          â”‚
â”‚                                                                             â”‚
â”‚             Fresh-roasted coffee that pays farmers fairly.                  â”‚
â”‚                    No middlemen. Full transparency.                         â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚                   ðŸŽ You've been invited to the table!                      â”‚
â”‚                                                                             â”‚
â”‚                        Get 10% off your first order                         â”‚
â”‚                                                                             â”‚
â”‚                         [Shop Now with 10% Off]                             â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚                        "Coffee the way it should be.                        â”‚
â”‚                      Fresh, honest, made with love."                        â”‚
â”‚                                                                             â”‚
â”‚                           [Read Our Story â†’]                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Checkout â€” Referral Discount Applied

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  Order Summary                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚                                                                             â”‚
â”‚  Ethiopia Yirgacheffe (250g, Whole Bean)          â‚¬14.90                    â”‚
â”‚  Colombia Huila (250g, Filter)                    â‚¬13.50                    â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Subtotal                                         â‚¬28.40                    â”‚
â”‚  ðŸŽ Referral Discount (10%)                       -â‚¬2.84                    â”‚
â”‚  Shipping (Standard DE)                            â‚¬4.95                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Total                                            â‚¬30.51                    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ðŸŽ‰ Referral discount applied! Your friend will receive a free bag    â”‚  â”‚
â”‚  â”‚    of coffee when your order is confirmed.                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Email â€” Reward Notification

When someone's referral converts:

```
Subject: ðŸŽ Sarah ordered â€” your free coffee is waiting!

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Hey Marcel,

Great news! Your friend Sarah just placed their first order.

As a thank you for spreading the word, you've earned:

    ðŸŽ FREE: Brazil Santos (250g)
    
    This one's on us. Add it to your next order, or we'll 
    ship it separately for just â‚¬4.95.

    [Claim Your Free Coffee â†’]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

You've now referred 5 friends to Marie Lou's table. 
That's 5 farmers earning fair wages, 5 people enjoying 
fresh coffee, and 5 free bags for you.

Oma would be proud. â˜•

â€” Marcel

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

---

## Admin Dashboard â€” Referral Section

### Referral Analytics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ðŸŽ Referral Program                                    [This Month â–¼]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Referrals  â”‚  â”‚ Converted  â”‚  â”‚ Conversion â”‚  â”‚ Rewards    â”‚             â”‚
â”‚  â”‚ Created    â”‚  â”‚            â”‚  â”‚ Rate       â”‚  â”‚ Given      â”‚             â”‚
â”‚  â”‚    127     â”‚  â”‚     43     â”‚  â”‚   33.8%    â”‚  â”‚    43      â”‚             â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚  (~â‚¬215)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Top Referrers                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚  1. thomas.k@example.com         12 referrals    12 free bags               â”‚
â”‚  2. sarah.m@example.com           8 referrals     8 free bags               â”‚
â”‚  3. emma.l@example.com            6 referrals     6 free bags               â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸ Flagged for Review (unusual activity)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  â€¢ suspicious@example.com â€” 25 referrals this week (avg is 2)               â”‚
â”‚    [Review] [Block]                                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Website Content â€” Referral Program Page

### English

```markdown
# Marie Lou's Table

## Pull Up a Chair for a Friend

My grandmother Marie Lou never drank her coffee alone. Her kitchen table 
was always set for one more â€” a neighbor, a friend, sometimes someone 
she'd just met. Everyone was welcome.

That's what this referral program is about. When you invite someone to 
try Marie Lou Coffee, you're not just sharing a product â€” you're inviting 
them to a table where quality matters, farmers are treated fairly, and 
every cup is made with love.

---

## How It Works

**1. Share Your Link**
Every Marie Lou customer gets a unique referral link. Share it with 
friends, family, colleagues â€” anyone who deserves better coffee.

**2. They Get 10% Off**
When your friend uses your link, they'll get 10% off their first order. 
A warm welcome to the table.

**3. You Get a Free Bag**
Once their order is confirmed, we'll send you a free bag of coffee â€” 
picked randomly from our current selection. A thank-you from us.

---

## The Details

**For You (the referrer):**
- Get 1 free bag (250g) for each friend who orders
- No limit â€” refer 10 friends, get 10 bags
- Choose to add it to your next order or ship separately (â‚¬4.95)
- Your reward never expires

**For Your Friend:**
- 10% off their first order
- Minimum order: â‚¬25 (before shipping)
- Valid for 90 days

---

## Why a Random Bag?

We could let you choose, but where's the fun in that?

The random bag is a little gift, a surprise, a chance to try something 
you might not have picked yourself. Maybe you'll discover your new 
favorite. Maybe it'll be an old friend.

Either way, it's our way of saying thank you for spreading the word.

---

## Get Your Referral Link

[Log in to your account to get your unique referral link â†’]

Not a customer yet? [Shop now â†’] and you'll get your link after 
your first order.

---

*There's always room at Marie Lou's table.*
```

### German

```markdown
# Marie Lous Tisch

## Hol einen Freund an den Tisch

Meine GroÃŸmutter Marie Lou trank ihren Kaffee nie allein. Ihr KÃ¼chentisch 
war immer fÃ¼r einen mehr gedeckt â€” eine Nachbarin, eine Freundin, manchmal 
jemand, den sie gerade erst kennengelernt hatte. Jeder war willkommen.

Darum geht es bei diesem Empfehlungsprogramm. Wenn du jemanden einlÃ¤dst, 
Marie Lou Coffee zu probieren, teilst du nicht nur ein Produkt â€” du lÃ¤dst 
sie an einen Tisch ein, an dem QualitÃ¤t zÃ¤hlt, Bauern fair behandelt werden 
und jede Tasse mit Liebe gemacht wird.

---

## So funktioniert's

**1. Teile deinen Link**
Jeder Marie Lou Kunde bekommt einen einzigartigen Empfehlungslink. Teile 
ihn mit Freunden, Familie, Kollegen â€” allen, die besseren Kaffee verdienen.

**2. Sie bekommen 10% Rabatt**
Wenn dein Freund deinen Link nutzt, bekommt er 10% Rabatt auf seine erste 
Bestellung. Ein herzliches Willkommen am Tisch.

**3. Du bekommst eine GratistÃ¼te**
Sobald die Bestellung bestÃ¤tigt ist, schicken wir dir eine kostenlose 
TÃ¼te Kaffee â€” zufÃ¤llig aus unserem aktuellen Sortiment ausgewÃ¤hlt. 
Ein DankeschÃ¶n von uns.

---

## Die Details

**FÃ¼r dich (Empfehler):**
- 1 GratistÃ¼te (250g) fÃ¼r jeden Freund, der bestellt
- Kein Limit â€” 10 Freunde empfehlen, 10 TÃ¼ten bekommen
- Zu deiner nÃ¤chsten Bestellung hinzufÃ¼gen oder separat versenden (â‚¬4,95)
- Deine Belohnung lÃ¤uft nie ab

**FÃ¼r deinen Freund:**
- 10% Rabatt auf die erste Bestellung
- Mindestbestellwert: â‚¬25 (vor Versand)
- 90 Tage gÃ¼ltig

---

## Warum eine zufÃ¤llige TÃ¼te?

Wir kÃ¶nnten dich wÃ¤hlen lassen, aber wo bleibt da der SpaÃŸ?

Die zufÃ¤llige TÃ¼te ist ein kleines Geschenk, eine Ãœberraschung, eine 
Chance, etwas zu probieren, das du vielleicht nicht selbst ausgesucht 
hÃ¤ttest. Vielleicht entdeckst du deinen neuen Lieblingskaffee. Vielleicht 
ist es ein alter Bekannter.

So oder so ist es unsere Art, Danke zu sagen, dass du uns weiterempfiehlst.

---

## Hol dir deinen Empfehlungslink

[Melde dich in deinem Konto an, um deinen persÃ¶nlichen Link zu bekommen â†’]

Noch kein Kunde? [Jetzt einkaufen â†’] und du bekommst deinen Link nach 
deiner ersten Bestellung.

---

*Am Tisch von Marie Lou ist immer Platz.*
```

---

## Implementation Phases

### Add to Phase 8 (Subscriptions) or Create Phase 8.5

```
### Phase 8.5: Referral Program (Week 9-10)

- [ ] Add referral tables to database schema
- [ ] Create referral code generation system
- [ ] Build /ref/[code] landing page
- [ ] Implement referral tracking during signup
- [ ] Add referral discount at checkout
- [ ] Create reward fulfillment system
- [ ] Build account page referral section
- [ ] Create referral notification emails
- [ ] Build admin referral analytics
- [ ] Implement anti-abuse detection
- [ ] Add referral program page (/referral)
- [ ] Create share widgets (WhatsApp, email, copy link)
```

---

## Economics Summary

| Metric                        | Value                                        |
| ----------------------------- | -------------------------------------------- |
| Cost per free bag             | ~â‚¬5-6 (green beans + roasting + packaging)   |
| Typical CAC (other companies) | â‚¬15-30                                       |
| Your effective CAC            | â‚¬5-6 (only paid on conversion)               |
| + You get:                    | Brand ambassadors who believe in the mission |

### Break-Even Analysis

If average customer orders 3x per year at â‚¬40 average order value:
- Customer lifetime value (year 1): ~â‚¬120
- Cost to acquire (1 free bag): ~â‚¬5-6
- **ROI: 20x in year 1 alone**

Even if only 50% of referred customers reorder:
- Still 10x ROI
- Plus they might refer others too

---

## Final Thoughts

This referral program:

âœ… **Fits the brand story** â€” Grandma's table, always room for one more
âœ… **Zero upfront cost** â€” Only "pay" when you get a new paying customer  
âœ… **Creates community** â€” Customers become ambassadors
âœ… **Surprise & delight** â€” Random bag adds joy
âœ… **Sustainable** â€” Economics work at any scale
âœ… **Simple** â€” Easy to understand, easy to use

The name "Marie Lou's Table" ties it all together beautifully. It's not a corporate referral program â€” it's an invitation to join something meaningful.

---

*Add this document to the coding agent package alongside the other files.*